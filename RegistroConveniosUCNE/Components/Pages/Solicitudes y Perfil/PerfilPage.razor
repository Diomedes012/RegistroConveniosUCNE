@page "/Perfil-info"

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">


<div class="profile-page-container">

    <div class="sidebar">
        <div class="sidebar-icon"><i class="bi bi-house"></i></div>
        <div class="sidebar-icon"><i class="bi bi-gear"></i></div>
        <div class="sidebar-icon"><i class="bi bi-person"></i></div>
        <div class="sidebar-icon"><i class="bi bi-box-arrow-right"></i></div>
    </div>

    <div class="main-content">

        <div class="header-yellow">
            <img src="images/logoUcnePeq.png" class="logo-header" alt="Logo" />
            <h1 class="page-title">Perfil</h1>
        </div>

        <div class="header-gray"></div>

        <div class="profile-body">

            <div class="profile-picture-container">
                <div class="profile-picture">
                    <div class="profile-icon-inner">
                        <div class="profile-icon-head"></div>
                        <div class="profile-icon-body"></div>
                    </div>
                </div>
            </div>

            <div class="profile-details">

                <div class="profile-field">
                    <label class="field-label">Nombre</label>
                    <button type="button" class="btn btn-outline-secondary profile-button-override" @onclick='() => OpenEditModal(" Nombre")'>
                        @user.Nombre <i class="bi bi-pencil-fill edit-icon"></i>
                    </button>
                </div>

                <div class="profile-field">
                    <label class="field-label">Correo electrónico</label>
                    <button type="button" class="btn btn-outline-secondary profile-button-override" @onclick='() => OpenEditModal(" Correo")'>
                        @user.Correo <i class="bi bi-pencil-fill edit-icon"></i>
                    </button>
                </div>

                <div class="profile-field">
                    <label class="field-label">Rol</label>
                    <button type="button" class="btn btn-outline-secondary profile-button-override" disabled>
                        @user.Rol
                    </button>
                </div>

                <div class="profile-field">
                    <label class="field-label">Número de teléfono</label>
                    <button type="button" class="btn btn-outline-secondary profile-button-override" @onclick='() => OpenEditModal(" Telefono")'>
                        @user.Telefono <i class="bi bi-pencil-fill edit-icon"></i>
                    </button>
                </div>

            </div>
        </div>
    </div>
</div>

@if (showModal)
{
    <div class="modal-backdrop fade show"></div>

    <div class="modal fade show" tabindex="-1" style="display: block;" role="dialog">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content modal-content-custom">

                <div class="modal-header">
                    <h5 class="modal-title">Editar @currentEditField</h5>
                    <button type="button" class="btn-close" @onclick="CancelEdit" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    <p>Por favor, introduce el nuevo valor para <strong>@currentEditField</strong>:</p>
                    <input type="text" class="form-control" @bind="currentValueToEdit" />
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" @onclick="CancelEdit">Cancelar</button>
                    <button type="button" class="btn btn-primary" @onclick="SaveChanges">Guardar Cambios</button>
                </div>
            </div>
        </div>
    </div>
}

@code {
    private class UserProfileModel
    {
        public string Nombre { get; set; }
        public string Correo { get; set; }
        public string Rol { get; set; }
        public string Telefono { get; set; }
    }

    private UserProfileModel user = new UserProfileModel
    {
        Nombre = "Juan Carlos Pérez García",
        Correo = "juan.perez@empresa.com",
        Rol = "Administrador",
        Telefono = "+506 8888-7777"
    };

    private bool showModal = false;
    private string currentEditField = "";
    private string currentValueToEdit = "";

    private void OpenEditModal(string fieldName)
    {
        currentEditField = fieldName;

        switch (fieldName)
        {
            case "Nombre":
                currentValueToEdit = user.Nombre;
                break;
            case "Correo":
                currentValueToEdit = user.Correo;
                break;
            case "Telefono":
                currentValueToEdit = user.Telefono;
                break;
        }
        showModal = true;
    }

    private void SaveChanges()
    {
        switch (currentEditField)
        {
            case "Nombre":
                user.Nombre = currentValueToEdit;
                break;
            case "Correo":
                user.Correo = currentValueToEdit;
                break;
            case "Telefono":
                user.Telefono = currentValueToEdit;
                break;
        }
        showModal = false;
    }

    private void CancelEdit()
    {
        showModal = false;
    }
}