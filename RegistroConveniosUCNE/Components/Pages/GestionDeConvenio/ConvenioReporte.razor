@page "/perfil"

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<div class="profile-page">

    <!-- ======= ENCABEZADO ======= -->
    <header class="profile-header">
        <img src="images/logoUcnePeq.png" alt="Logo UCNE" class="profile-logo" />
        <h1 class="profile-title">PERFIL</h1>
    </header>

    <!-- ======= CONTENEDOR PRINCIPAL ======= -->
    <div class="profile-container">

        <!-- ======= SIDEBAR ======= -->
        <nav class="profile-sidebar">
            <i class="bi bi-person"></i>
            <i class="bi bi-file-text"></i>
            <i class="bi bi-toggle2-on"></i>
            <i class="bi bi-bell"></i>
            <i class="bi bi-box-arrow-right"></i>
        </nav>

        <!-- ======= CONTENIDO ======= -->
        <main class="profile-content">
            <div class="profile-picture">
                <i class="bi bi-person-fill"></i>
            </div>

            <div class="profile-info">
                <div class="profile-section">
                    <div class="profile-section-header">
                        <label>Nombre</label>
                        <i class="bi bi-pencil-square edit-btn" @onclick='() => OpenEditModal(" Nombre")'></i>
                    </div>
                    <div class="profile-section-body">@user.Nombre</div>
                </div>

                <div class="profile-section">
                    <div class="profile-section-header">
                        <label>Correo electrónico</label>
                        <i class="bi bi-pencil-square edit-btn" @onclick='() => OpenEditModal(" Correo")'></i>
                    </div>
                    <div class="profile-section-body">@user.Correo</div>
                </div>

                <div class="profile-section">
                    <div class="profile-section-header">
                        <label>Rol</label>
                    </div>
                    <div class="profile-section-body">@user.Rol</div>
                </div>

                <div class="profile-section">
                    <div class="profile-section-header">
                        <label>Número de teléfono</label>
                        <i class="bi bi-pencil-square edit-btn" @onclick='() => OpenEditModal(" Telefono")'></i>
                    </div>
                    <div class="profile-section-body">@user.Telefono</div>
                </div>
            </div>
        </main>
    </div>
</div>

@if (showModal)
{
    <div class="modal-backdrop fade show"></div>

    <div class="modal fade show" tabindex="-1" style="display: block;" role="dialog">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content modal-content-custom">
                <div class="modal-header">
                    <h5 class="modal-title">Editar @currentEditField</h5>
                    <button type="button" class="btn-close" @onclick="CancelEdit" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Por favor, introduce el nuevo valor:</p>
                    <input type="text" class="form-control" @bind="currentValueToEdit" />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" @onclick="CancelEdit">Cancelar</button>
                    <button type="button" class="btn btn-primary" @onclick="SaveChanges">Guardar</button>
                </div>
            </div>
        </div>
    </div>
}

@code {
    private class UserProfileModel
    {
        public string Nombre { get; set; } = "Juan Carlos Pérez García";
        public string Correo { get; set; } = "juan.perez@empresa.com";
        public string Rol { get; set; } = "Administrador";
        public string Telefono { get; set; } = "+506 8888-7777";
    }

    private UserProfileModel user = new();
    private bool showModal = false;
    private string currentEditField = string.Empty;
    private string currentValueToEdit = string.Empty;

    private void OpenEditModal(string fieldName)
    {
        currentEditField = fieldName;

        currentValueToEdit = fieldName switch
        {
            "Nombre" => user.Nombre,
            "Correo" => user.Correo,
            "Telefono" => user.Telefono,
            _ => string.Empty
        };

        showModal = true;
    }

    private void SaveChanges()
    {
        switch (currentEditField)
        {
            case "Nombre": user.Nombre = currentValueToEdit; break;
            case "Correo": user.Correo = currentValueToEdit; break;
            case "Telefono": user.Telefono = currentValueToEdit; break;
        }

        showModal = false;
    }

    private void CancelEdit() => showModal = false;
}
